---
import HeaderLink from './HeaderLink.astro';
import {SITE_TITLE} from '../consts';
import Logo from '../assets/logo.svg'
import ViewTransitions from 'astro/components/ViewTransitions.astro';
---

<header class="sticky top-3 px-16 bg-blur site-header header-up">
    <nav class="flex justify-between shadow-2xl h-14 px-3 items-center rounded-xl bg-zinc-100 mx-auto dark:bg-gray-800 transition-colors duration-500 border-b-blueGray dark:shadow-amber shadow-green transition-shadow z-10">
        <div class="flex items-center gap-sm pl-6">
            <img src={Logo.src} class="h-8" alt=""/>
            <a class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-300  to-emerald-500 to-90% font-bold nav-site-title shadow-2xl text-lg group cursor-pointer "
               href="/">
                {SITE_TITLE}
                <div class="bg-teal-500 h-[2px] w-0 group-hover:w-full transition-all duration-500"></div>
            </a>
        </div>

        <div class="flex justify-center items-center gap-2">
            <div class="flex justify-center items-center gap-2">
                <a class="hover:bg-zinc-400 hover:bg-op-20 p-2 lg:px-1.5 lg:py-1 transition-bg duration-300 rounded-lg hover:color-blue cursor-pointer dark:color-white flex items-center justify-center gap-1  "
                   href="/">
                    <div class="i-material-symbols:home"/>
                    <div class="hidden lg:inline">首页</div>
                </a>
                <a class="hover:bg-zinc-400 hover:bg-op-20 p-2  lg:px-1.5 lg:py-1  transition-bg duration-300 rounded-lg hover:color-blue cursor-pointer dark:color-white flex items-center justify-center gap-1  "
                   href="/blog/page/1">
                    <div class="i-material-symbols:text-snippet"/>
                    <div class="hidden lg:inline">归档</div>
                </a>
                <a class="hover:bg-zinc-400 hover:bg-op-20 p-2  lg:px-1.5 lg:py-1  transition-bg duration-300 rounded-l hover:color-blue cursor-pointer dark:color-white  flex items-center justify-center gap-1  ">
                    <div class="i-mdi:tag"/>
                    <div class="hidden lg:inline">标签</div>
                </a>
                <a class="hover:bg-zinc-400 hover:bg-op-20 p-2   lg:px-1.5 lg:py-1 transition-bg duration-300 rounded-l hover:color-blue cursor-pointer dark:color-white  flex items-center justify-center gap-1 ">
                    <div class="i-mdi:face-cool-outline"/>
                    <div class="hidden lg:inline">关于</div>
                </a>
            </div>
            <button class="theme-toggle flex items-center hover:bg-zinc-400 hover:bg-op-20 rounded-xl p-1.5 transition-bg duration-300"
                    id="themeToggle" title="切换白天/黑暗模式"
                    aria-label="auto"
                    aria-live="polite">
                <div id="themeToggleIcon"
                     class="i-line-md:sun-rising-filled-loop color-red dark:hidden transition-colors duration-200 w-5 h-5"/>
                <div class=" i-line-md:moon-rising-filled-loop color-white hidden dark:block transition-colors duration-200  w-5 h-5"/>
            </button>
        </div>
    </nav>

</header>
<style>
    .dark > .nav-site-title {
        text-shadow: 2px 1px 10px #fff;
    }

    .site-header {
        transition: top 0.2s ease-in-out;
        .header-down {

        }
        &.header-up {
            top: -100px;
        }
    }
</style>
<script is:inline>
    let didScroll;
    let lastScrollTop = 0;
    const delta = 5;
    const navbar = document.querySelector('.site-header');
    const navbarHeight = navbar.offsetHeight;

    function hasScrolled() {
        const st = window.scrollY;

        // Make sure they scroll more than delta
        if (Math.abs(lastScrollTop - st) <= delta) return;

        // If they scrolled down and are past the navbar, add class .nav-up.
        if (st > lastScrollTop && st > navbarHeight) {
            // Scroll Down
            navbar.classList.remove('header-down');
            navbar.classList.add('header-up');
        } else {
            // Scroll Up
            if (st + window.innerHeight < document.documentElement.scrollHeight) {
                navbar.classList.remove('header-up');
                navbar.classList.add('header-down');
            }
        }

        lastScrollTop = st;
    }

    document.addEventListener('astro:page-load', () => {
        window.addEventListener('scroll', function () {
            didScroll = true;
        });
        setInterval(function () {
            if (didScroll) {
                hasScrolled();
                didScroll = false;
            }
        }, 250);
    });

</script>
<script is:inline>
    document.addEventListener('astro:page-load', () => {
        const theme = (() => {
            if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
                return localStorage.getItem('theme');
            }
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return 'dark';
            }
            return 'light';
        })();

        if (theme === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark');
        }

        window.localStorage.setItem('theme', theme);

        const handleToggleClick = (event) => {
            console.log("clicked")
            const element = document.documentElement;
            element.classList.toggle("dark");

            const isDark = element.classList.contains("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
        }

        document.getElementById("themeToggle").addEventListener("click", handleToggleClick);
    })
</script>


<script is:inline>
    document.addEventListener('astro:page-load', () => {
        const {OverlayScrollbars, ClickScrollPlugin} = OverlayScrollbarsGlobal;

        // optional: use the ClickScrollPlugin to make the option "scrollbars.clickScroll: true" available
        OverlayScrollbars.plugin(ClickScrollPlugin);

        OverlayScrollbars(document.body, {
            scrollbars: {
                clickScroll: true,
            },
        });
        // OverlayScrollbars(document.getElementById('target'), {});
    })
</script>

<script is:inline>
    function applyTheme() {
        localStorage.theme === 'dark'
            ? document.documentElement.classList.add("dark")
            : document.documentElement.classList.remove("dark");
    }

    document.addEventListener('astro:after-swap', applyTheme);
    applyTheme();
</script>
